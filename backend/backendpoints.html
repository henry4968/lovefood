<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LOVEFOOD管理中心</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.js"></script>
    <link rel="stylesheet" href="../css/backstage/backstageAll.css">
    <script src="../node_modules/moment/min/moment.min.js"></script>
    <script src="../node_modules/bootstrap-datetimepicker-sass/src/js/bootstrap-datetimepicker.js"></script>
    <script src="../js/23/product/datetime.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
</head>

<body>
    <div class="containerPoints">
        <div class="navWrapper">
            <nav>
                <div class="navLeft">
                    <img src="../img/23/loveFood_logo1.png" alt="">
                    <h1>管理中心</h1>
                </div>
                <svg xmlns="http://www.w3.org/2000/svg" width="36" height="35.965" viewBox="0 0 36 35.965">
                    <path id="放大鏡"
                        d="M35.332,35.3a2.25,2.25,0,0,1-3.2,0l-6.96-6.961A15.7,15.7,0,0,1,9.633,30.217,15.521,15.521,0,0,1,1.248,21.85a15.659,15.659,0,0,1,0-12.252,15.684,15.684,0,0,1,3.357-5.01,15.885,15.885,0,0,1,5.027-3.34,15.618,15.618,0,0,1,12.235,0,16.036,16.036,0,0,1,5.027,3.34A15.588,15.588,0,0,1,30.252,9.6,15.388,15.388,0,0,1,31.5,15.715a15.339,15.339,0,0,1-3.129,9.422L35.332,32.1a2.25,2.25,0,0,1,0,3.2ZM15.75,4.5A11.214,11.214,0,0,0,4.5,15.733,11.2,11.2,0,0,0,15.75,26.965,11.214,11.214,0,0,0,27,15.732,11.195,11.195,0,0,0,15.75,4.5Z"
                        transform="translate(0 0)" fill="#887664" />
                </svg>
            </nav>
        </div>
        <div class="asideMainWrapper">
            <aside>
                <div>
                    <ul class="member">
                        <li>管理員</li>
                        <user></user>
                    </ul>

                    <ul class="sideNav">
                        <a class="a-sideLink" href="backendIndex.html">
                            <div>
                                <svg xmlns="http://www.w3.org/2000/svg" width="30.422" height="30.422"
                                    viewBox="0 0 30.422 30.422">
                                    <path id="Path_34" data-name="Path 34"
                                        d="M26.59,26.959C25.233,24.807,22.248,22.5,16.143,22.5S7.056,24.8,5.7,26.96a13.5,13.5,0,0,0,20.893,0Z"
                                        transform="translate(-0.932 -3.369)" fill="#897666" />
                                    <path id="Path_35" data-name="Path 35"
                                        d="M16.9,18.04A5.645,5.645,0,1,0,11.25,12.4,5.645,5.645,0,0,0,16.9,18.04Z"
                                        transform="translate(-1.684 -1.011)" fill="#897666" fill-rule="evenodd" />
                                    <path id="Path_36" data-name="Path 36"
                                        d="M15.211,1.9a13.31,13.31,0,1,0,13.31,13.31A13.31,13.31,0,0,0,15.211,1.9ZM0,15.211A15.211,15.211,0,1,1,15.211,30.422,15.211,15.211,0,0,1,0,15.211Z"
                                        fill="#897666" fill-rule="evenodd" />
                                </svg>
                                <li>會員管理</li>
                            </div>
                        </a>
                        <a class="a-sideLink" href="backendOrder.html">
                            <div>
                                <svg xmlns="http://www.w3.org/2000/svg" width="22.857" height="32"
                                    viewBox="0 0 22.857 32">
                                    <path id="Path_37" data-name="Path 37"
                                        d="M29.264,10.593l-8-8a1.04,1.04,0,0,0-.8-.343H9.036A2.286,2.286,0,0,0,6.75,4.536V31.964A2.286,2.286,0,0,0,9.036,34.25H27.321a2.286,2.286,0,0,0,2.286-2.286V11.393a1.04,1.04,0,0,0-.342-.8Zm-8.8-5.6,6.4,6.4h-6.4Zm6.857,26.971H9.036V4.536h9.143v6.857a2.286,2.286,0,0,0,2.286,2.286h6.857Z"
                                        transform="translate(-6.75 -2.25)" fill="#887664" />
                                    <path id="Path_38" data-name="Path 38"
                                        d="M16.469,23.47l-3.38-2.331L11.25,22.408l5.219,3.6,10.438-7.2-1.839-1.269Z"
                                        transform="translate(-7.65 -0.337)" fill="#887664" />
                                </svg>
                                <li>訂單管理</li>
                            </div>
                        </a>
                        <a class="a-sideLink" href="backendProduct.html">
                            <div>
                                <svg xmlns="http://www.w3.org/2000/svg" width="30.422" height="30.422"
                                    viewBox="0 0 30.422 30.422">
                                    <path id="bag"
                                        d="M30.5,10.942H26.153v-.305A8.361,8.361,0,0,0,17.766,2.25h-.544a8.419,8.419,0,0,0-8.453,8.387v.305H4.423L2.25,32.672H32.672Zm-19.557-.305a6.257,6.257,0,0,1,6.281-6.214h.544a6.2,6.2,0,0,1,6.214,6.214v.305H10.942ZM4.681,30.5,6.372,13.115h2.4V15.58a2.173,2.173,0,1,0,2.173,0V13.115H23.98V15.58a2.173,2.173,0,1,0,2.173,0V13.115h2.4L30.248,30.5Z"
                                        transform="translate(-2.25 -2.25)" fill="#887664" />
                                </svg>
                                <li>商品管理</li>
                            </div>
                        </a>
                        <a class="a-sideLink" href="backendpoints.html">
                            <div class="currentPage">
                                <svg xmlns="http://www.w3.org/2000/svg" width="28.422" height="24.869"
                                    viewBox="0 0 28.422 24.869">
                                    <path id="diamond"
                                        d="M24.869,0l3.553,7.105H21.316ZM15.987,0h7.105L19.54,7.105ZM10.658,7.105,14.211,0l3.553,7.105ZM5.329,0h7.105L8.882,7.105ZM0,7.105,3.553,0,7.105,7.105ZM12.435,24.869,0,8.882H7.105ZM19.54,8.882,14.211,24.869,8.882,8.882Zm8.882,0L15.987,24.869,21.316,8.882Z"
                                        fill="#887664" />
                                </svg>
                                <li>點數管理</li>
                            </div>
                        </a>
                        <a class="a-sideLink" href="backendFinance.html">
                            <div>
                                <svg xmlns="http://www.w3.org/2000/svg" width="28.422" height="28.422"
                                    viewBox="0 0 28.422 28.422">
                                    <path id="Icon_open-folder" data-name="Icon open-folder"
                                        d="M0,0V7.105H28.422V3.553H10.658V0ZM0,10.658V26.646a1.759,1.759,0,0,0,1.776,1.776H26.646a1.759,1.759,0,0,0,1.776-1.776V10.658Z"
                                        fill="#887664" />
                                </svg>
                                <li>財務管理</li>
                            </div>
                        </a>
                        <button class="btn-s btn-brown">登出</button>
                    </ul>
                </div>
            </aside>
            <main>
                <div id="pointsDataControlArea">
                    <div id="pointsDataFilterTabsBlock">
                        <div id="pointsDataFilterTab01" class="pointsDataFilterTab" @click="showTab = true"
                            :class="{'tabActive' : showTab === true}">
                            單筆編輯</div>
                        <div id="pointsDataFilterTab02" class="pointsDataFilterTab" @click="showTab = false"
                            :class="{'tabActive' : showTab === false}">批次上傳</div>
                    </div>
                    <div id="pointsDataFilter" v-show="showTab">
                        <div id="pointsDataFilterLeftUpperBlock">
                            <div id="pointsDataFilterLeftUpperBlockRow01" class="pointsDataFilterLeftUpperBlockRow">
                                <div>會員編號</div>
                                <input type="text" name="id" class="form-control">
                                <div>會員帳號</div>
                                <input type="text" name="account" class="form-control">
                            </div>
                            <div id="pointsDataFilterLeftUpperBlockRow02" class="pointsDataFilterLeftUpperBlockRow">
                                <div>會員姓名</div>
                                <input type="text" name="name" class="form-control">
                                <div>會員手機</div>
                                <input type=" text" name="phone" class="form-control">
                            </div>
                        </div>
                        <div id="pointsDataFilterRightBlock">
                            查詢區間<br>
                            <div id="queryDateRow">
                                <div class="form-group">
                                    <label class="sr-only">Time Pick</label>
                                    <div class="input-group DateDemo" id="">
                                        <input type="text" name="dateStart" data-format="MM/DD/YYYY" value="2021-01-01"
                                            class="form-control" id="queryDateStart" />
                                        <span class="input-group-btn">
                                            <button class="btn btn-brown" type="button"><i
                                                    class="glyphicon glyphicon-calendar fa-4x"></i></button>
                                        </span>
                                    </div>
                                </div>
                                <span>
                                    至
                                </span>
                                <div class="form-group">
                                    <label class="sr-only">Time Pick</label>
                                    <div class="input-group DateDemo">
                                        <input type="text" name="dateEnd" data-format="MM/DD/YYYY" value="2021-12-31"
                                            class="form-control" id="queryDateEnd" />
                                        <span class="input-l input-group-btn">
                                            <button class="btn btn-brown" type="button"><i
                                                    class="glyphicon glyphicon-calendar fa-4x"></i></button>
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <button id="pointsDataFilterButton01" class="btn-s btn-brown"
                                @click="queryPoints">查詢</button>
                        </div>
                    </div>
                    <div id="pointsDataUploader" v-show="!showTab">
                        <h4>★ 注意：請上傳規範內容的csv檔，以執行批次發放點數</h4>
                        <div id="uploadCSVBlock">
                            <label id="labelForCSVFileInput" class="form-control" for="csvFileInput">點擊選擇檔案</label>
                            <input id="csvFileInput" type="file" name="importCSV" class="form-control"
                                @input="showFileName" style="display: none;">
                            <button @click="uploadCSV" id="uploadCSVButton" class="btn-s btn-brown">確認上傳</button>
                        </div>
                    </div>
                </div>
                <div id="pointsResultData" class="pointsDataArea"
                    v-show="showTab && !showIssuanceDetails && !showUsingDetails">
                    <table>
                        <tr id="pointsDataHeader">
                            <th>序號</th>
                            <th>會員編號</th>
                            <th>會員帳號</th>
                            <th>會員姓名</th>
                            <th>會員手機</th>
                            <th>區間點數</th>
                            <th>現有點數</th>
                            <th>查閱詳情</th>
                        </tr>
                        <tbody v-if="pointsOfMember" v-for="(data,key) in pointsOfMember">
                            <h4>▊ 查詢區間：【<span id="showDateStart">2021-01-01</span>】至【<span
                                    id="showDateEnd">2021-12-31</span>】
                            </h4><br>
                            <tr>
                                <td>{{key+1}}</td>
                                <td>{{data["MEMBER_ID"]}}</td>
                                <td>{{data["MEMBER_ACCOUNT"]}}</td>
                                <td>{{data["MEMBER_NAME"]}}</td>
                                <td>{{data["MEMBER_PHONE"]}}</td>
                                <td v-if='data["TOTAL_ISSUANCE"] - data["TOTAL_DISCOUNT"]'>
                                    {{data["TOTAL_ISSUANCE"] - data["TOTAL_DISCOUNT"]}}
                                </td>
                                <td v-else-if='data["TOTAL_ISSUANCE"] && !data["TOTAL_DISCOUNT"]'>
                                    {{data["TOTAL_ISSUANCE"] - 0}}
                                </td>
                                <td v-else-if='!data["TOTAL_ISSUANCE"] && data["TOTAL_DISCOUNT"]'>
                                    {{0 - data["TOTAL_ISSUANCE"]}}
                                </td>
                                <td v-else>
                                    0
                                </td>
                                <td>
                                    {{data["MEMBER_POINTS"]}}
                                </td>
                                <td>
                                    <button type="submit" class="btn-xs btn-brown" @click="showUsingLog"
                                        :data-id="data['MEMBER_ID']" :data-id="data['NAME']">使用紀錄</button>
                                    <button type="submit" class="btn-xs btn-brown" @click="showIssuanceLog"
                                        :data-id="data['MEMBER_ID']" :data-id="data['NAME']">發放紀錄</button>
                                </td>
                            </tr>
                        </tbody>
                        <tbody v-else="pointsOfMember">
                            <tr v-for="(data,key) in membersListPageView">
                                <td>{{key+1}}</td>
                                <td>{{data["MEMBER_ID"]}}</td>
                                <td>{{data["MEMBER_ACCOUNT"]}}</td>
                                <td>{{data["MEMBER_NAME"]}}</td>
                                <td>{{data["MEMBER_PHONE"]}}</td>
                                <td>{{data["MEMBER_POINTS"]}}</td>
                                <td>
                                    <button type="submit" class="btn-xs btn-brown" @click="showUsingLog"
                                        :data-id="data['MEMBER_ID']" :data-id="data['NAME']">使用紀錄</button>
                                    <button type="submit" class="btn-xs btn-brown" @click="showIssuanceLog"
                                        :data-id="data['MEMBER_ID']" :data-id="data['NAME']">發放紀錄</button>

                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="pagination" id="membersListPagination" v-if="membersListPageView">
                        <a href="#0" @click="membersListPageChange(0)">＜</a>
                        <a href="#0" @click="membersListPageChange(1)">1</a>
                        <a href="#0" @click="membersListPageChange(2)">2</a>
                        <a href="#0" @click="membersListPageChange(3)">3</a>
                        <a href="#0" @click="membersListPageChange(4)">4</a>
                        <a href="#0" @click="membersListPageChange(5)">5</a>
                        <a href="#0" @click="membersListPageChange('next')">＞</a>
                        <a href="#0">最末頁</a>
                    </div>
                </div>
                <div id="pointsUsingLogData" class="pointsDataArea" v-show="showTab && showUsingDetails">
                    <button @click="queryPoints">
                        回上頁
                    </button>
                    <div class="memberProfileBlock">
                        <div class="memberProfile" v-for="(data,key) in pointsOfMember">
                            <h4>▊ 所選會員</h4>
                            <div class="memberProfileRow">
                                會員編號：<input class="input-xl" type="text" :value="data['MEMBER_ID']" name="selectedId"
                                    disabled>
                                會員帳號：<input class="input-xl" type="text" :value="data['MEMBER_ACCOUNT']" disabled>
                            </div>
                            <div class="memberProfileRow">
                                會員姓名：<input class="input-xl" type="text" :value="data['MEMBER_NAME']" disabled>
                                會員手機：<input class="input-xl" type="text" :value="data['MEMBER_PHONE']" disabled>
                            </div>
                        </div>
                        <div class="memberPointsInput" v-for="(data,key) in pointsOfMember">
                            <h4>▊ 點數修改</h4>
                            現有點數：
                            <input class="input-xl pointsOfMember" id="pointsOfMember01" type="text"
                                :value="data['MEMBER_POINTS']" disabled><br>
                            發放點數：
                            <input class="input-xl issuancePointsInput" id="issuancePointsInput01" type="number"
                                name="points01" placeholder="不超過單筆3000的整數"
                                onkeyup="value=value.replace(/^(0+)|[^\d]+/g,'')">
                            <button class="btn-xs btn-brown" @click="issuancePoints">確認發放</button><br>
                            刪減點數：
                            <input class="input-xl cutPointsInput" id="cutPointsInput01" type="number" name="points03"
                                placeholder="不超過現有點數的整數" onkeyup="value=value.replace(/^(0+)|[^\d]+/g,'')">
                            <button class="btn-xs btn-brown" @click="cutPoints">確認刪減</button>
                        </div>
                    </div>
                    <div class="systemLogBlock">
                        <h4>▊ 使用紀錄</h4>
                        <table>
                            <thead>
                                <tr>
                                    <th>序號</th>
                                    <th>訂單編號</th>
                                    <th>使用點數</th>
                                    <th>使用時間</th>
                                </tr>
                            </thead>
                            <tbody v-if="discountLog">
                                <tr v-for="(data,key) in singleDiscountPageView">
                                    <td>{{key+1}}</td>
                                    <td>{{data["ORDER_ID"]}}</td>
                                    <td>{{data["ORDER_DISCOUNT"]}}</td>
                                    <td>{{data["ORDER_DATE"]}}</td>
                            </tbody>
                        </table>
                        <div class="pagination" id="singleDiscountPagination" v-if="singleDiscountPageView">
                            <a href="#0" @click="singleDiscountpageChange(0)">＜</a>
                            <a href="#0" @click="singleDiscountpageChange(1)">1</a>
                            <a href="#0" @click="singleDiscountpageChange(2)">2</a>
                            <a href="#0" @click="singleDiscountpageChange(3)">3</a>
                            <a href="#0" @click="singleDiscountpageChange(4)">4</a>
                            <a href="#0" @click="singleDiscountpageChange(5)">5</a>
                            <a href="#0" @click="singleDiscountpageChange('next')">＞</a>
                            <a href="#0">最末頁</a>
                        </div>
                    </div>
                </div>
                <div id="pointsIssuanceLogData" class="pointsDataArea" v-show="showTab && showIssuanceDetails">
                    <button @click="queryPoints">
                        回上頁
                    </button>
                    <div class="memberProfileBlock">
                        <div class="memberProfile" v-for="(data,key) in pointsOfMember">
                            <h4>▊ 所選會員</h4>
                            <div class="memberProfileRow">
                                會員編號：<input class="input-xl" type="text" :value="data['MEMBER_ID']" name="selectedId"
                                    disabled>
                                會員帳號：<input class="input-xl" type="text" :value="data['MEMBER_ACCOUNT']" disabled>
                            </div>
                            <div class="memberProfileRow">
                                會員姓名：<input class="input-xl" type="text" :value="data['MEMBER_NAME']" disabled>
                                會員手機：<input class="input-xl" type="text" :value="data['MEMBER_PHONE']" disabled>
                            </div>
                        </div>
                        <div class="memberPointsInput" v-for="(data,key) in pointsOfMember">
                            <h4>▊ 點數修改</h4>
                            現有點數：
                            <input class="input-xl pointsOfMember" id="pointsOfMember02" type="text"
                                :value="data['MEMBER_POINTS']" disabled><br>
                            發放點數：
                            <input class="input-xl issuancePointsInput" id="issuancePointsInput02" type="number"
                                name="points02" placeholder="不超過單筆3000的整數"
                                onkeyup="value=value.replace(/^(0+)|[^\d]+/g,'')">
                            <button class="btn-xs btn-brown" @click="issuancePoints">確認發放</button><br>
                            刪減點數：
                            <input class="input-xl cutPointsInput" id="cutPointsInput02" type="number" name="points04"
                                placeholder="不超過現有點數的整數" onkeyup="value=value.replace(/^(0+)|[^\d]+/g,'')">
                            <button class="btn-xs btn-brown" @click="cutPoints">確認刪減</button>
                        </div>
                    </div>
                    <div class="systemLogBlock">
                        <h4>▊ 發放紀錄：</h4>
                        <table>
                            <thead>
                                <tr>
                                    <th>序號</th>
                                    <th>發放序號</th>
                                    <th>發放點數</th>
                                    <th>發放時間</th>
                                </tr>
                            </thead>
                            <tbody v-if="issuanceLog">
                                <tr v-for="(data,key) in singleIssuancePageView">
                                    <td>{{key+1}}</td>
                                    <td>{{data["POINTS_ISSUANCE_ID"]}}</td>
                                    <td>{{data["POINTS_ISSUANCE_NUM"]}}</td>
                                    <td>{{data["POINTS_ISSUANCE_DATE"]}}</td>
                            </tbody>
                        </table>
                        <div class="pagination" id="singleIssuancePagination" v-if="singleIssuancePageView">
                            <a href="#0" @click="singleIssuancePageChange(0)">＜</a>
                            <a href="#0" @click="singleIssuancePageChange(1)">1</a>
                            <a href="#0" @click="singleIssuancePageChange(2)">2</a>
                            <a href="#0" @click="singleIssuancePageChange(3)">3</a>
                            <a href="#0" @click="singleIssuancePageChange(4)">4</a>
                            <a href="#0" @click="singleIssuancePageChange(5)">5</a>
                            <a href="#0" @click="singleIssuancePageChange('next')">＞</a>
                            <a href="#0">最末頁</a>
                        </div>
                    </div>
                </div>
                <div id="pointsUploadData" class="pointsDataArea" v-show="!showTab">
                    <h4>▊ 批次發放結果：</h4><br>
                    <table>
                        <tr id="pointsDataHeader">
                            <th>序號</th>
                            <th>發放編號</th>
                            <th>會員編號</th>
                            <th>會員帳號</th>
                            <th>會員姓名</th>
                            <th>發放點數</th>
                            <th>發放時間</th>
                            <th>會員現有點數</th>
                        </tr>
                        <tbody v-if="uploadCSVLog" v-for="(data,key) in batchIssuancePageView">
                            <tr>
                                <td>{{key+1}}</td>
                                <td>{{data["POINTS_ISSUANCE_ID"]}}</td>
                                <td>{{data["MEMBER_ID_for_PI"]}}</td>
                                <td>{{data["MEMBER_ACCOUNT"]}}</td>
                                <td>{{data["MEMBER_NAME"]}}</td>
                                <td>{{data["POINTS_ISSUANCE_NUM"]}}</td>
                                <td>{{data["POINTS_ISSUANCE_DATE"]}}</td>
                                <td>{{data["MEMBER_POINTS"]}}</td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="pagination" id="batchIssuancePagination" v-if="batchIssuancePageView">
                        <a href="#0" @click="batchIssuancePageChange(0)">＜</a>
                        <a href="#0" @click="batchIssuancePageChange(1)">1</a>
                        <a href="#0" @click="batchIssuancePageChange(2)">2</a>
                        <a href="#0" @click="batchIssuancePageChange(3)">3</a>
                        <a href="#0" @click="batchIssuancePageChange(4)">4</a>
                        <a href="#0" @click="batchIssuancePageChange(5)">5</a>
                        <a href="#0" @click="batchIssuancePageChange('next')">＞</a>
                        <a href="#0">最末頁</a>
                    </div>
                </div>
            </main>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.12/dist/vue.js"></script>
    <script src="../js/22/backendpoints.js"></script>

</body>

</html>